<!doctype html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>deepstream.io | Records, Events and RPCs</title>

	

	<meta http-equiv="content-type" content="text/html; charset=utf-8" />
	<meta name="keywords" content="deepstream, deepstream.io, streaming, realtime, server, socket" />
	<meta name="description" content="a short overview over deepstream&#x27;s core concepts" />
	<meta name="author" content="Wolfram Hempel" />
	<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
	<link rel="icon" href="/favicon.ico" type="image/x-icon">
	<link rel="stylesheet" type="text/css" href="../assets/css/navigation.css" />
	<link rel="stylesheet" type="text/css" href="../assets/css/screen.css" />
	<link rel="stylesheet" type="text/css" href="../assets/css/api.css" />
	<script type="text/javascript">
	document.createElement( 'header' );
	document.createElement( 'nav' );
	</script>
	<script type="text/javascript" src="../assets/js/jquery.js"></script>
	<script type="text/javascript" src="../assets/js/menu.js"></script>
	<script type="text/javascript" src="../assets/js/prism.js"></script>

	<link href='http://fonts.googleapis.com/css?family=Montserrat' rel='stylesheet' type='text/css'>
	<link href='http://fonts.googleapis.com/css?family=Quicksand:300,400,700' rel='stylesheet' type='text/css'>
	<link href='http://fonts.googleapis.com/css?family=Roboto' rel='stylesheet' type='text/css'>
	<link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
	<link rel="stylesheet" type="text/css" href="../assets/css/prism.css" />
</head>

<body class="category_tutorials ">
	<div class="mobile-menu">
		<div class="nav mobile-nav">
			<ul>
				<li ><a href="..">Home</a></li>
				<li ><a href="../download/">Downloads</a></li>
				<li class="active"><a href="../tutorials/getting-started.html">Tutorials</a></li>
				<li ><a href="../docs/deepstream.html">Documentation</a></li>
				<li ><a href="../blog/">Blog</a></li>
				<li ><a href="../info/">Info</a></li>
			</ul>		</div>
	</div>

	<div id="outer-wrapper">
		<div id="header" class="compact-header">
			<div class="header-tiny-logo">
				<h1><a href="..">deepstream.io - a scalable server for realtime web apps</a></h1>
			</div>
			<div class="nav desktop-nav">
				<ul>
					<li ><a href="..">Home</a></li>
					<li ><a href="../download/">Downloads</a></li>
					<li class="active"><a href="../tutorials/getting-started.html">Tutorials</a></li>
					<li ><a href="../docs/deepstream.html">Documentation</a></li>
					<li ><a href="../blog/">Blog</a></li>
					<li ><a href="../info/">Info</a></li>
				</ul>			</div>
			<span class="menu-button menu-icon">
				<i class="fa fa-bars"></i>
			</span>
		</div>
		<div id="wrapper" class="main">
			<ul id="subnav">
	<li class="head first">General</li>
	<li >
		<a href="getting-started.html">Getting started</a>
		<div class="isActiveIndicator orangeGradient"></div>
	</li>
	<li >
		<a href="authentication.html">Authentication</a>
		<div class="isActiveIndicator orangeGradient"></div>
	</li>
	<li >
		<a href="permissioning.html">Permissioning</a>
		<div class="isActiveIndicator orangeGradient"></div>
	</li>

	<li class="head">Server</li>
	<li >
		<a href="connectors-and-deployment.html">Connectors and Deployment</a>
		<div class="isActiveIndicator orangeGradient"></div>
	</li>
	<li >
		<a href="data-provider.html">Building a data-provider</a>
		<div class="isActiveIndicator orangeGradient"></div>
	</li>
	<li >
		<a href="searching-and-querying.html">Searching & Querying</a>
		<div class="isActiveIndicator orangeGradient"></div>
	</li>
	<li >
		<a href="transforming-data.html">Transforming Data</a>
		<div class="isActiveIndicator orangeGradient"></div>
	</li>
	<li >
		<a href="writing-storage-cache-connector.html">Writing storage and cache connectors</a>
		<div class="isActiveIndicator orangeGradient"></div>
	</li>
	<li >
		<a href="writing-messaging-connector.html">Writing a messaging connector</a>
		<div class="isActiveIndicator orangeGradient"></div>
	</li>

	<li class="head">Client</li>
	<li >
		<a href="node-js-client.html">Using the client in NodeJS</a>
		<div class="isActiveIndicator orangeGradient"></div>
	</li>

	<li >
		<a href="records.html">Records</a>
		<div class="isActiveIndicator orangeGradient"></div>
	</li>

	<li >
		<a href="lists.html">Lists</a>
		<div class="isActiveIndicator orangeGradient"></div>
	</li>

	<li >
		<a href="events-and-rpcs.html">Events & RPCs</a>
		<div class="isActiveIndicator orangeGradient"></div>
	</li>

	<li >
		<a href="simple-app-using-ko.html">Simple App using Knockout</a>
		<div class="isActiveIndicator orangeGradient"></div>
	</li>

	<li >
		<a href="simple-app-using-react.html">Simple App using React</a>
		<div class="isActiveIndicator orangeGradient"></div>
	</li>

	<li >
		<a href="simple-app-using-angular.html">Simple App using Angular</a>
		<div class="isActiveIndicator orangeGradient"></div>
	</li>

	<li >
		<a href="webrtc.html">WebRTC</a>
		<div class="isActiveIndicator orangeGradient"></div>
	</li>

	<li >
		<a href="webrtc-tips.html">WebRTC Tips</a>
		<div class="isActiveIndicator orangeGradient"></div>
	</li>
</ul>

			<div id="content">
				<h1>Records, Events &amp; RPCs</h1><p>Deepstream provides three core concepts: Records, Events and RPCs. Records are arbitrary JSON structures that can be manipulated and subscribed to, Events work like a normal event-emitter, but distributed across connected clients and RPCs(Remote Procedure Calls) allow for request-response communication, comparable to http requests.</p><p>The functionality for each is grouped under a namespace on the client:</p><pre><code class="lang-javascript">var ds = require( &#39;deepstream.io-client-js&#39; )( &#39;localhost:6020&#39; );

//generic methods are on the client itself
ds.login();
ds.getUid();
...

//record related methods are on client.record
client.record.getRecord();
client.record.getList();
client.record.listen();
...

//event related methods are on client.event
client.event.subscribe();
client.event.emit();
...

//rpc related methods are on client.rpc
client.rpc.register();
client.rpc.make();
</code></pre>
<h3>Records</h3><p>Records are persistant data-structures. Deepstream can store them in both a distributed cache for quick read-write access and in a database for long-term storage and querying.</p><div class="section"><h2><a name="Choosingarecordname">Choosing a record name</a></h2><p>Every record is identified by a unique name. This name can be any string, but we found that there are some naming conventions that help a lot with larger scale applications:</p><h4>Use unique, randomized ids</h4><p>It&#39;s tempting to use a field that could act as primary key as the recordname, e.g. <code>user/johndoe</code>, but using a UID, e.g. <code>user/iam7f3vy-2mgd656jrx3di</code> has some advantages: You don&#39;t need to ensure its uniqueness, the user can change his username later without invalidating the record and ids generated with deepstream&#39;s <code>ds.getUid()</code> method are loosely sequential (the first 8 characters are a base64 encoded) which helps databases to index them more efficiently.</p><!--
<div class="hint-box fa fa-lightbulb-o">
    <h3>Won't my UIDs clash?</h3>
    <p>If you're coming from a SQL background, you're probably used to enabling <code>autoincrement</code> and leaving it to the database to work out a unique identifier via sequential numbering. This approach wouldn't work for distributed systems.</p>

    <p>Instead, deepstream provides a <code>ds.getUid()</code> method that provides random strings. These start with a timestamp â€“ which means two identical ids would need to be generated within the same millisecond. This is not impossible, but the likelihood for it to happen is 1: 10 Quadrillion.</p>
</div>
-->
<h4>Organize your records in groups</h4><p>Starting your recordnames with a group, e.g. <code>user/iam7f3vy-2mgd656jrx3di</code> rather than just <code>iam7f3vy-2mgd656jrx3di</code> makes them easier to organize and enables storage-connectors to create individual tables or collections per group.</p><h4>Include a group to help with permissioning</h4><p>If your system has to support multiple users or groups that are not allowed to access each others data, it might make sense to include the id of the group into the record name. This allows the permissionHandler to deny access to records straight away, if they don&#39;t belong to the user&#39;s group.</p><pre><code class="lang-javascript">// Client
var ds = deepstream( &#39;143.234.324.234:6020&#39; );
ds.login({ user: &#39;paul&#39;, pass: &#39;abc&#39; });
var rec = ds.record.getRecord( &#39;beatles-albums&#39; );

//Permission Handler
var users = {
    &#39;paul&#39;:  { pass: &#39;abc&#39;, group: &#39;beatles&#39; },
    &#39;john&#39;:  { pass: &#39;def&#39;, group: &#39;beatles&#39; },
    &#39;keith&#39;: { pass: &#39;ghi&#39;, group: &#39;stones&#39; },
    &#39;mick&#39;:  { pass: &#39;jkl&#39;, group: &#39;stones&#39; }
};

server.set( &#39;permissionHandler&#39;, {
    isValidUser: function( connectionData, authData, callback ) {
        if( users[ authData.user ].pass === authData.pass ) {
            callback( null, authData.user );
        } else {
            callback( &#39;Invalid Credentials&#39; );
        }
    },
    canPerformAction: function( username, message, callback ) {
        var recordName = message.data[ 0 ];
        var requestedGroup = recordName.split( &#39;-&#39; )[ 0 ];
        var actualGroup = users[ username ].group;

        callback( null, requestedGroup === actualGroup );
    }
});
</code></pre>
<h3>Record paths</h3><p>Most record operations can be performed for the entire record or for a path within it</p><pre><code class="lang-javascript">var someUser = ds.record.getRecord( &#39;someUser&#39; );

//setting the entire record&#39;s data
someRecord.set({
    firstname: &#39;John&#39;,
    lastname: &#39;Doe&#39;
});

//setting only a specific path
someRecord.set( &#39;firstname&#39;, &#39;Egon&#39; );

//paths can also be more complex and will create structures
//that don&#39;t exist yet
someRecord.set( &#39;hobbies[2].name&#39;, &#39;tap dancing&#39; );

/* Will result in
*
+ {
+     firstname: &#39;John&#39;,
+     lastname: &#39;Doe&#39;,
+     hobbies: [
+         undefined,
+         undefined,
+         { name: &#39;tap dancing&#39; }
+     ]
+  }
*/

//paths can also be used with get and subscribe
someRecord.get( &#39;lastname&#39; ); //&#39;Doe&#39;
someRecord.subscribe( &#39;lastname&#39;, function( lastname ){
    //will be called on the next change to lastname
});
</code></pre>
<h3>unsubscribe, discard and delete</h3><p>These can be a bit confusing</p><ul>
<li><strong>unsubscribe</strong> removes a subscription that was previously established using <code>subscribe</code></li>
<li><strong>discard</strong> notifies the server that the client is no longer interested in updates for this record.</li>
<li><strong>delete</strong> irreversibly deletes the record from storage and cache.</li>
</ul>
<h3>listening for record subscriptions made by other clients</h3><p>deepstream allows you to register a callback function that will be notified whenever clients subscribe to a record for the first time. This is useful to create dynamic data provider that provide record content only on request.</p><pre><code class="lang-javascript">//Browser Client
ds.record.getRecord( &#39;stock/HXTO&#39; )
    .subscribe(&#39;ask-price&#39;, function( askPrice ){
        //Will be called every time the ask-price for HXTO changes
    });

//Data Provider process on the backend that integrates deepstream with
//a stock data source
ds.record.listen( &#39;stock/*&#39;, function( recordName, isSubscribed ){
    var stockSymbol = recordName.replace( &#39;stock/&#39;, &#39;&#39; ),
        stockRecord = ds.record.getRecord( recordName );

    stockDataSource.getData( stockSymbol. function( stockData ){
        stockRecord.set( stockData );
    });
});
</code></pre>

			</div>
		</div>
		<script type="text/javascript" src="../assets/js/docs.js"></script>
	</div>
	<div id="footer">
		<ul class="footer-items">

			<li class="footer-right">
				<ul class="social">
					<li class="twitter">
						<a href="https://twitter.com/deepstreamIO">
							<i class="fa fa-twitter"></i>  Twitter
						</a>
					</li>
					<li class="github">
						<a href="https://github.com/deepstreamio">
							<i class="fa fa-github"></i>  Github
						</a>
					</li>
					<li class="stack-overflow">
						<a href="http://stackoverflow.com/questions/tagged/deepstream.io">
							<i class="fa fa-stack-overflow"></i>  Stack Overflow
						</a>
					</li>
					<li>
						<a href="https://deepstream-slack.herokuapp.com/">
							<i class="fa fa-slack"></i>  Slack
						</a>
					</li>
				</ul>
			</li>

			<li class="footer-middle">
				<h4>Browse</h4>
				<ul>
					<li ><a href="..">Home</a></li>
					<li ><a href="../download/">Downloads</a></li>
					<li class="active"><a href="../tutorials/getting-started.html">Tutorials</a></li>
					<li ><a href="../docs/deepstream.html">Documentation</a></li>
					<li ><a href="../blog/">Blog</a></li>
					<li ><a href="../info/">Info</a></li>
				</ul>			</li>

			<li class="footer-left">
				<h4>Contact us</h4>
				<p>
					<b>deepstream.io </b>is developed by Hoxton One Ltd. <br>
				</p>
				<p>
					Email us <a href="mailto:info@deepstream.io">info@deepstream.io</a>.<br><br>
				</p>

				<h4>Star this project on github!</h4>
				<p>
					<a class="github-button" href="https://github.com/hoxton-one/deepstream.io" data-icon="octicon-star" data-style="mega" data-count-href="/hoxton-one/deepstream.io/stargazers" data-count-api="/repos/hoxton-one/deepstream.io#stargazers_count" data-count-aria-label="# stargazers on GitHub" aria-label="Star hoxton-one/deepstream.io on GitHub">Star</a>
				</p>
			</li>

		</ul>
	</div>


	<script async defer id="github-bjs" src="https://buttons.github.io/buttons.js"></script>
</body>
</html>
