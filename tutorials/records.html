<!doctype html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>deepstream.io | Records tutorial</title>

	

	<meta http-equiv="content-type" content="text/html; charset=utf-8" />
	<meta name="keywords" content="deepstream, deepstream.io, streaming, realtime, server, socket" />
	<meta name="description" content="learn about records, deepstream&#x27;s observable data structures" />
	<meta name="author" content="Wolfram Hempel" />
	<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
	<link rel="icon" href="/favicon.ico" type="image/x-icon">
	<link rel="stylesheet" type="text/css" href="../assets/css/navigation.css" />
	<link rel="stylesheet" type="text/css" href="../assets/css/screen.css" />
	<link rel="stylesheet" type="text/css" href="../assets/css/api.css" />
	<script type="text/javascript">
	document.createElement( 'header' );
	document.createElement( 'nav' );
	</script>
	<script type="text/javascript" src="../assets/js/jquery.js"></script>
	<script type="text/javascript" src="../assets/js/menu.js"></script>
	<script type="text/javascript" src="../assets/js/prism.js"></script>

	<link href='http://fonts.googleapis.com/css?family=Montserrat' rel='stylesheet' type='text/css'>
	<link href='http://fonts.googleapis.com/css?family=Quicksand:300,400,700' rel='stylesheet' type='text/css'>
	<link href='http://fonts.googleapis.com/css?family=Roboto' rel='stylesheet' type='text/css'>
	<link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
	<link rel="stylesheet" type="text/css" href="../assets/css/prism.css" />
</head>

<body class="category_tutorials ">
	<div class="mobile-menu">
		<div class="nav mobile-nav">
			<ul>
				<li ><a href="..">Home</a></li>
				<li ><a href="../download/">Downloads</a></li>
				<li class="active"><a href="../tutorials/getting-started.html">Tutorials</a></li>
				<li ><a href="../docs/deepstream.html">Documentation</a></li>
				<li ><a href="../blog/">Blog</a></li>
				<li ><a href="../info/">Info</a></li>
			</ul>		</div>
	</div>

	<div id="outer-wrapper">
		<div id="header" class="compact-header">
			<div class="header-tiny-logo">
				<h1><a href="..">deepstream.io - a scalable server for realtime web apps</a></h1>
			</div>
			<div class="nav desktop-nav">
				<ul>
					<li ><a href="..">Home</a></li>
					<li ><a href="../download/">Downloads</a></li>
					<li class="active"><a href="../tutorials/getting-started.html">Tutorials</a></li>
					<li ><a href="../docs/deepstream.html">Documentation</a></li>
					<li ><a href="../blog/">Blog</a></li>
					<li ><a href="../info/">Info</a></li>
				</ul>			</div>
			<span class="menu-button menu-icon">
				<i class="fa fa-bars"></i>
			</span>
		</div>
		<div id="wrapper" class="main">
			<ul id="subnav">
	<li class="head first">General</li>
	<li >
		<a href="getting-started.html">Getting started</a>
		<div class="isActiveIndicator orangeGradient"></div>
	</li>
	<li >
		<a href="authentication.html">Authentication</a>
		<div class="isActiveIndicator orangeGradient"></div>
	</li>
	<li >
		<a href="permissioning.html">Permissioning</a>
		<div class="isActiveIndicator orangeGradient"></div>
	</li>

	<li class="head">Server</li>
	<li >
		<a href="connectors-and-deployment.html">Connectors and Deployment</a>
		<div class="isActiveIndicator orangeGradient"></div>
	</li>
	<li >
		<a href="data-provider.html">Building a data-provider</a>
		<div class="isActiveIndicator orangeGradient"></div>
	</li>
	<li >
		<a href="searching-and-querying.html">Searching & Querying</a>
		<div class="isActiveIndicator orangeGradient"></div>
	</li>
	<li >
		<a href="transforming-data.html">Transforming Data</a>
		<div class="isActiveIndicator orangeGradient"></div>
	</li>
	<li >
		<a href="writing-storage-cache-connector.html">Writing storage and cache connectors</a>
		<div class="isActiveIndicator orangeGradient"></div>
	</li>
	<li >
		<a href="writing-messaging-connector.html">Writing a messaging connector</a>
		<div class="isActiveIndicator orangeGradient"></div>
	</li>

	<li class="head">Client</li>
	<li >
		<a href="node-js-client.html">Using the client in NodeJS</a>
		<div class="isActiveIndicator orangeGradient"></div>
	</li>

	<li class="active">
		<a href="records.html">Records</a>
		<div class="isActiveIndicator orangeGradient"></div>
	</li>

	<li >
		<a href="lists.html">Lists</a>
		<div class="isActiveIndicator orangeGradient"></div>
	</li>

	<li >
		<a href="events-and-rpcs.html">Events & RPCs</a>
		<div class="isActiveIndicator orangeGradient"></div>
	</li>

	<li >
		<a href="simple-app-using-ko.html">Simple App using Knockout</a>
		<div class="isActiveIndicator orangeGradient"></div>
	</li>

	<li >
		<a href="simple-app-using-react.html">Simple App using React</a>
		<div class="isActiveIndicator orangeGradient"></div>
	</li>

	<li >
		<a href="simple-app-using-angular.html">Simple App using Angular</a>
		<div class="isActiveIndicator orangeGradient"></div>
	</li>

	<li >
		<a href="webrtc.html">WebRTC</a>
		<div class="isActiveIndicator orangeGradient"></div>
	</li>

	<li >
		<a href="webrtc-tips.html">WebRTC Tips</a>
		<div class="isActiveIndicator orangeGradient"></div>
	</li>

	<li class="head">Internals</li>
	<li >
		<a href="message-structure.html">Message Structure</a>
		<div class="isActiveIndicator orangeGradient"></div>
	</li>
</ul>

			<div id="content">
				<h1>Records</h1><p><a href="docs/record.html">Records</a> are arbitrary JSON structures that can be manipulated and subscribed to. Every change to a record is synced accross all subscribed clients</p><pre><code class="lang-javascript">//creating or retrieving a record is the same
var johnDoe = ds.record.getRecord( &#39;johnDoe&#39; );

//you can set the entire record&#39;s content
johnDoe.set({ firstname: &#39;John&#39;, lastname: &#39;Doe&#39; });

//or just a path within the record
johnDoe.set( &#39;age&#39;, 28 );

//getting data from a record works the same
johnDoe.get();

//but be aware, if your record exists already
//it needs a brief moment to receive its data
johnDoe.whenReady(function(){
    alert( johnDoe.get( &#39;middleName&#39; ));
});

//or if you just want to get the value of a
//specific path
johnDoe.get( &#39;firstname&#39; );

//paths can be as complex as you like. If you
//set a value for a path that doesn&#39;t exist yet,
//deepstream will create it
johnDoe.set( &#39;hobbies[2].name&#39;, &#39;skiing&#39; );

//you can subscribe to changes of the entire record...
johnDoe.subscribe(function( data ){ /*...*/ });

//or just the changes of a specific field
var happyBirthday = function( newAge ){ alert( &#39;Happy birthday&#39; );};
johnDoe.subscribe( &#39;age&#39;, happyBirthday );

//You can remove subscriptions
johnDoe.unsubscribe( &#39;age&#39;, happyBirthday );

//records also emit events
johnDoe.on( &#39;delete&#39;, function(){
    alert( &#39;someone deleted this record&#39; );
});

//Once you are no longer interested in receiving
//updates for this record, call discard
johnDoe.discard();

//Or delete the record entirely
johnDoe.delete();
</code></pre>
<h3>Record names</h3><p>Every record is identified by a unique name. This name can be any string, but we found that there are some naming conventions that help a lot with larger scale applications:</p><h4>Use unique, randomized ids</h4><p>It&#39;s tempting to use a field that could act as primary key as the recordname, e.g. <code>user/johndoe</code>, but using a UID, e.g. <code>user/iam7f3vy-2mgd656jrx3di</code> has some advantages: You don&#39;t need to ensure its uniqueness, the user can change his username later without invalidating the record and ids generated with deepstream&#39;s <code>ds.getUid()</code> method are loosely sequential (the first 8 characters are a base64 encoded) which helps databases to index them more efficiently.</p><h4>Organize your records into collections</h4><p>Prefixing your record names with a collection, e.g. <code>user/bob</code> rather than just <code>bob</code> makes them easier to organize and allows storage-connectors to create individual database tables or collections for each.</p><h4>Use a security group to support permissioning</h4><p>If your system has to support multiple users or groups that are not allowed to access each others data, it might make sense to include the id of the group into the record name. This allows the permissionHandler to deny access to records straight away if they don&#39;t belong to the user&#39;s group.</p><p><strong>Client</strong></p><pre><code class="lang-javascript">var ds = deepstream( &#39;143.234.324.234:6020&#39; );
ds.login({ user: &#39;paul&#39;, pass: &#39;abc&#39; }, function( success ){
    if( success ) {
        //Allowed
        var recA = ds.record.getRecord( &#39;beatles-albums&#39; );
        //Forbidden
        var recB = ds.record.getRecord( &#39;stones-albums&#39; );
    }
});
</code></pre>
<p><strong>Server</strong></p><pre><code class="lang-javascript">//Permission Handler
var users = {
    &#39;paul&#39;:  { pass: &#39;abc&#39;, group: &#39;beatles&#39; },
    &#39;john&#39;:  { pass: &#39;def&#39;, group: &#39;beatles&#39; },
    &#39;keith&#39;: { pass: &#39;ghi&#39;, group: &#39;stones&#39; },
    &#39;mick&#39;:  { pass: &#39;jkl&#39;, group: &#39;stones&#39; }
};

server.set( &#39;permissionHandler&#39;, {
    isValidUser: function( connectionData, authData, callback ) {
        if( users[ authData.user ].pass === authData.pass ) {
            callback( null, authData.user );
        } else {
            callback( &#39;Invalid Credentials&#39; );
        }
    },
    canPerformAction: function( username, message, callback ) {
        var recordName = message.data[ 0 ];
        var requestedGroup = recordName.split( &#39;-&#39; )[ 0 ];
        var actualGroup = users[ username ].group;

        callback( null, requestedGroup === actualGroup );
    }
});
</code></pre>
<h3>Lists &amp; Anonymous Records</h3><p>Deepstream has two other concepts that extend records: <a href="lists.html">Lists</a> and Anonymous Records.</p><p><a href="lists.html">Lists</a> are arrays of record names that come with a number of helper-methods like <code>addEntry</code> or <code>removeEntry</code>.</p><p>An Anonymous Record is a record without a predefined name. It
acts as a wrapper around an actual record that can be swapped out for another one whilst keeping all bindings intact.</p><h3>Listening for record subscriptions made by other clients</h3><p>deepstream allows you to register a callback function that will be notified whenever clients subscribe to a record for the first time. This is useful to create dynamic data providers that provide record content only on request.</p><pre><code class="lang-javascript">//Browser Client
ds.record.getRecord( &#39;stock/HXTO&#39; )
    .subscribe(&#39;ask-price&#39;, function( askPrice ){
        //Will be called every time the ask-price for HXTO changes
    });

//Data Provider process on the backend that integrates deepstream with
//a stock data source
ds.record.listen( &#39;stock/*&#39;, function( recordName, isSubscribed ){
    var stockSymbol = recordName.replace( &#39;stock/&#39;, &#39;&#39; ),
        stockRecord = ds.record.getRecord( recordName );

    stockDataSource.getData( stockSymbol. function( stockData ){
        stockRecord.set( stockData );
    });
});
</code></pre>

			</div>
		</div>
		<script type="text/javascript" src="../assets/js/docs.js"></script>
	</div>
	<div id="footer">
		<ul class="footer-items">

			<li class="footer-right">
				<ul class="social">
					<li class="twitter">
						<a href="https://twitter.com/deepstreamIO">
							<i class="fa fa-twitter"></i>  Twitter
						</a>
					</li>
					<li class="github">
						<a href="https://github.com/hoxton-one">
							<i class="fa fa-github"></i>  Github
						</a>
					</li>
					<li class="stack-overflow">
						<a href="http://stackoverflow.com/questions/tagged/deepstream.io">
							<i class="fa fa-stack-overflow"></i>  Stack Overflow
						</a>
					</li>
					<li>
						<a href="https://deepstream-slack.herokuapp.com/">
							<i class="fa fa-slack"></i>  Slack
						</a>
					</li>
				</ul>
			</li>

			<li class="footer-middle">
				<h4>Browse</h4>
				<ul>
					<li ><a href="..">Home</a></li>
					<li ><a href="../download/">Downloads</a></li>
					<li class="active"><a href="../tutorials/getting-started.html">Tutorials</a></li>
					<li ><a href="../docs/deepstream.html">Documentation</a></li>
					<li ><a href="../blog/">Blog</a></li>
					<li ><a href="../info/">Info</a></li>
				</ul>			</li>

			<li class="footer-left">
				<h4>Contact us</h4>
				<p>
					<b>deepstream.io </b>is developed by Hoxton One Ltd. <br>
				</p>
				<p>
					Email us <a href="mailto:info@deepstream.io">info@deepstream.io</a>.<br><br>
				</p>

				<h4>Star this project on github!</h4>
				<p>
					<a class="github-button" href="https://github.com/hoxton-one/deepstream.io" data-icon="octicon-star" data-style="mega" data-count-href="/hoxton-one/deepstream.io/stargazers" data-count-api="/repos/hoxton-one/deepstream.io#stargazers_count" data-count-aria-label="# stargazers on GitHub" aria-label="Star hoxton-one/deepstream.io on GitHub">Star</a>
				</p>
			</li>

		</ul>
	</div>


	<script>
		(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
		(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
		m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
		})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

		ga('create', 'UA-63583386-1', 'auto');
		ga('send', 'pageview');
	</script>
	<script async defer id="github-bjs" src="https://buttons.github.io/buttons.js"></script>
</body>
</html>
